---
author: liuyd
comments: true
date: 2013-03-22 10:26:03+00:00
layout: post
slug: '%e5%85%b1%e4%ba%ab%e7%a3%81%e7%9b%98%e4%b8%ad%e5%88%9b%e5%bb%ba%e6%96%87%e4%bb%b6%e5%b9%b6%e6%8c%82%e8%bd%bd'
title: 共享磁盘中创建文件并挂载
wordpress_id: 205
categories:
- 学习报告
---

创建共享磁盘：
在VirtualBox中创建共享磁盘
1，选择一台虚拟机点击左上角的设置，在弹出对话框中选择存储，选择控制器右边的添加虚拟硬盘
2，创建新的虚拟硬盘，选择文件类型为VDI，下一步，固定大小中输入磁盘大小和位置，点击创建，创建完成后确定
3，在虚拟机管理菜单中选择虚拟介质管理，选择刚创建的虚拟硬盘，点击修改，将介质类型选择为可共享，确定
4，在另外一台机器上选择设置，选择存储，在控制器中添加虚拟硬盘，使用现有的虚拟盘，在刚才创建盘的位置中找到VDI文件，打开确定
5，使用fdisk -l 命令可以分别在虚拟机中查看到
[root@node1 ~]# fdisk -l

Disk /dev/sda: 26.8 GB, 26843545600 bytes
255 heads, 63 sectors/track, 3263 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Device Boot Start End Blocks Id System
/dev/sda1 * 1 13 104391 83 Linux
/dev/sda2 14 3263 26105625 8e Linux LVM

Disk /dev/sdb: 42.9 GB, 42949672960 bytes
255 heads, 63 sectors/track, 5221 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/sdb doesn't contain a valid partition table
[root@node2 ~]# fdisk -l

Disk /dev/sda: 26.8 GB, 26843545600 bytes
255 heads, 63 sectors/track, 3263 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Device Boot Start End Blocks Id System
/dev/sda1 * 1 13 104391 83 Linux
/dev/sda2 14 3263 26105625 8e Linux LVM

Disk /dev/sdb: 42.9 GB, 42949672960 bytes
255 heads, 63 sectors/track, 5221 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/sdb doesn't contain a valid partition table
其中的/dev/sdb就是刚创建的共享磁盘

创建VG及卷组

将共享磁盘格式化为 Linux LVM
[root@node1 ~]# fdisk /dev/sdb
Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel
Building a new DOS disklabel. Changes will remain in memory only,
until you decide to write them. After that, of course, the previous
content won't be recoverable.
The number of cylinders for this disk is set to 5221.
There is nothing wrong with that, but this is larger than 1024,
and could in certain setups cause problems with:
1) software that runs at boot time (e.g., old versions of LILO)
2) booting and partitioning software from other OSs
(e.g., DOS FDISK, OS/2 FDISK)
Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

Command (m for help): m
Command action
a toggle a bootable flag
b edit bsd disklabel
c toggle the dos compatibility flag
d delete a partition
l list known partition types
m print this menu
n add a new partition
o create a new empty DOS partition table
p print the partition table
q quit without saving changes
s create a new empty Sun disklabel
t change a partition's system id
u change display/entry units
v verify the partition table
w write table to disk and exit
x extra functionality (experts only)

Command (m for help): n //创建一个分区
Command action
e extended
p primary partition (1-4)
p //创建主分区
Partition number (1-4): 1 //创建一个主分区
First cylinder (1-5221, default 1): 1 //第一个分区起始柱面
Last cylinder or +size or +sizeM or +sizeK (1-5221, default 5221): //第一个分区结束柱面
Using default value 5221

Command (m for help): t //改变分区ID
Selected partition 1
Hex code (type L to list codes): 8e
Changed system type of partition 1 to 8e (Linux LVM)

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.

[root@node2 ~]# fdisk -l

Disk /dev/sda: 26.8 GB, 26843545600 bytes
255 heads, 63 sectors/track, 3263 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Device Boot Start End Blocks Id System
/dev/sda1 * 1 13 104391 83 Linux
/dev/sda2 14 3263 26105625 8e Linux LVM

Disk /dev/sdb: 42.9 GB, 42949672960 bytes
255 heads, 63 sectors/track, 5221 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Device Boot Start End Blocks Id System
/dev/sdb1 1 5221 41937651 8e Linux LVM

创建PV
[root@node1 ~]# pvcreate -f /dev/sdb1
Physical volume "/dev/sdb1" successfully created

创建VG
[root@node1 ~]# vgcreate -s 64 vgdb /dev/sdb1
Volume group "vgdb" successfully created

[root@node1 ~]# vgdisplay -v /dev/vgdb
Using volume group(s) on command line
Finding volume group "vgdb"
--- Volume group ---
VG Name vgdb
System ID
Format lvm2
Metadata Areas 1
Metadata Sequence No 1
VG Access read/write
VG Status resizable
MAX LV 0
Cur LV 0
Open LV 0
Max PV 0
Cur PV 1
Act PV 1
VG Size 39.94 GB
PE Size 64.00 MB
Total PE 639
Alloc PE / Size 0 / 0
Free PE / Size 639 / 39.94 GB
VG UUID BMhijK-5CdR-LPu1-gzvd-dWvs-fk7M-kkmaGO

--- Physical volumes ---
PV Name /dev/sdb1
PV UUID CXB30F-CWav-xnn0-Kqc9-SuaA-K0j4-FKPa0Q
PV Status allocatable
Total PE / Free PE 639 / 639

创建LV
[root@node1 ~]# lvcreate -L 15G -n /dev/vgdb/lvoracle /dev/vgdb
Logical volume "lvoracle" created
[root@node1 ~]# lvcreate -L 10G -n /dev/vgdb/lvoradata /dev/vgdb
Logical volume "lvoradata" created
[root@node1 ~]# lvcreate -L 14G -n /dev/vgdb/lvdbackup /dev/vgdb
Logical volume "lvdbackup" created

[root@node1 ~]# vgdisplay -v /dev/vgdb
Using volume group(s) on command line
Finding volume group "vgdb"
--- Volume group ---
VG Name vgdb
System ID
Format lvm2
Metadata Areas 1
Metadata Sequence No 4
VG Access read/write
VG Status resizable
MAX LV 0
Cur LV 3
Open LV 0
Max PV 0
Cur PV 1
Act PV 1
VG Size 39.94 GB
PE Size 64.00 MB
Total PE 639
Alloc PE / Size 624 / 39.00 GB
Free PE / Size 15 / 960.00 MB
VG UUID BMhijK-5CdR-LPu1-gzvd-dWvs-fk7M-kkmaGO

--- Logical volume ---
LV Name /dev/vgdb/lvoracle
VG Name vgdb
LV UUID mZda2e-lIN5-VJrm-OtHX-9usn-Cy3i-susfdS
LV Write Access read/write
LV Status available
# open 0
LV Size 15.00 GB
Current LE 240
Segments 1
Allocation inherit
Read ahead sectors auto
- currently set to 256
Block device 253:2

--- Logical volume ---
LV Name /dev/vgdb/lvoradata
VG Name vgdb
LV UUID 6QN5DW-If8X-6IDH-wy2g-aD8k-RB9X-z1mfvI
LV Write Access read/write
LV Status available
# open 0
LV Size 10.00 GB
Current LE 160
Segments 1
Allocation inherit
Read ahead sectors auto
- currently set to 256
Block device 253:3

--- Logical volume ---
LV Name /dev/vgdb/lvdbackup
VG Name vgdb
LV UUID RZDGGo-wqT3-SHQk-aU9w-XpyD-VIME-3Z3LM2
LV Write Access read/write
LV Status available
# open 0
LV Size 14.00 GB
Current LE 224
Segments 1
Allocation inherit
Read ahead sectors auto
- currently set to 256
Block device 253:4

--- Physical volumes ---
PV Name /dev/sdb1
PV UUID CXB30F-CWav-xnn0-Kqc9-SuaA-K0j4-FKPa0Q
PV Status allocatable
Total PE / Free PE 639 / 15

创建文件系统
[root@node1 ~]# mkfs -t ext2 /dev/vgdb/lvoracle
mke2fs 1.39 (29-May-2006)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
1966080 inodes, 3932160 blocks
196608 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=4026531840
120 block groups
32768 blocks per group, 32768 fragments per group
16384 inodes per group
Superblock backups stored on blocks:
32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208

Writing inode tables: done
Writing superblocks and filesystem accounting information: done

This filesystem will be automatically checked every 31 mounts or
180 days, whichever comes first. Use tune2fs -c or -i to override.
[root@node1 ~]# mkfs -t ext2 /dev/vgdb/lvoradata
mke2fs 1.39 (29-May-2006)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
1310720 inodes, 2621440 blocks
131072 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2684354560
80 block groups
32768 blocks per group, 32768 fragments per group
16384 inodes per group
Superblock backups stored on blocks:
32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Writing inode tables: done
Writing superblocks and filesystem accounting information: done

This filesystem will be automatically checked every 29 mounts or
180 days, whichever comes first. Use tune2fs -c or -i to override.
[root@node1 ~]# mkfs -t ext2 /dev/vgdb/lvdbackup
mke2fs 1.39 (29-May-2006)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
1835008 inodes, 3670016 blocks
183500 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=3758096384
112 block groups
32768 blocks per group, 32768 fragments per group
16384 inodes per group
Superblock backups stored on blocks:
32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208

Writing inode tables: done
Writing superblocks and filesystem accounting information: done

This filesystem will be automatically checked every 31 mounts or
180 days, whichever comes first. Use tune2fs -c or -i to override.

创建mount目录
[root@node1 ~]# mount /dev/mapper/vgdb-lvoracle /oracle
[root@node1 ~]# mount /dev/mapper/vgdb-lvoradata /oradata
[root@node1 ~]# df -h
Filesystem Size Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00
21G 5.3G 15G 28% /
/dev/sda1 99M 13M 82M 14% /boot
tmpfs 1006M 0 1006M 0% /dev/shm
/dev/mapper/vgdb-lvoracle
15G 38M 14G 1% /oracle
/dev/mapper/vgdb-lvoradata
9.9G 23M 9.4G 1% /oradata
